<!DOCTYPE html>
<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
	<script src="rough.js"></script>
<style>
canvas {
    border: 1px solid black;
    background-color: #f1f1f1;
}
</style>
    </head>
    <body onload="startGame()">
    <script>
var hoister;

function startGame() {
    hoister = new Hoister(30,30,"red",240-30,500);
    hoistArea.start();
}
var hoistArea = {
    canvas: document.createElement("canvas"),
    start: function() {
        this.canvas.width = 480;
        this.canvas.height = 600;
	this.context = rough.canvas(this.canvas)
	    this.normalContext = this.canvas.getContext('2d');
        this.normalContext.font = "30px Arial";
        document.body.insertBefore(this.canvas, document.body.childNodes[0]);
        this.interval = setInterval(updateHoistArea, 20);
        this.key = '';

        window.addEventListener('keypress', function(e) {
            hoistArea.key = e.key;
        }, false)
    },
    clear: function() {
        this.normalContext.clearRect(0, 0, this.canvas.width, this.canvas.height);
    }
}
function Hoister(width, height, color, x, y) {
    this.width = width;
    this.height = height;
    this.x = x;
    this.y = y;
    this.v_x = 0;
    this.v_y = 0;
    this.gravity = 0;
    this.gravitySpeed = 0;
    this.update = function() {
        this.x += this.v_x;
        this.gravitySpeed += this.gravity;
        this.y += this.v_y + this.gravitySpeed;
        ctx = hoistArea.context;
        ctx.fillStyle = color;
	ctx.circle(this.x, this.y, this.width, { fill: color }); // fill with red hachure
    }
}
function letter(letter, x, y, direction) {
    this.letter = letter;
    this.x = x;
    this.y = y;
    this.update = function() {
        this.y += 1;
        if (this.y > hoistArea.canvas.height) {
            return false;
        }
        ctx = hoistArea.normalContext;
	var measure = ctx.measureText(this.letter);
        ctx.fillText(this.letter, this.x-measure.width/2, this.y+10);
        return true;
    }
}
var frame = 0;
var letters = [];
var lettersChoice = ['A','B','C','D','E','F','G','H','I','J','K','L','M','N','O','P','Q','R','S','T','U','V','W','X','Y','Z'];
function updateHoistArea() {
    frame += 1;
    if (lettersChoice.length) {
        if (Math.random() < .03) {
            var index = Math.floor(Math.random()*lettersChoice.length);
            var newLetter = lettersChoice[index];
            lettersChoice.splice(index, 1);
            letters.push(new letter(newLetter, Math.random()*hoistArea.canvas.width, 0, 2*Math.pi*Math.random()))
        }
    }
    hoistArea.clear();
    letters.forEach((letter) => {
        if (!letter.update()) {
            lettersChoice.push(letter.letter)
            letters.splice(letters.indexOf(letter), 1)
        }
    });
    if (hoistArea.key) {
        var grappleLetter = letters.find(letter => letter.letter.toLowerCase() == hoistArea.key.toLowerCase());
        if (grappleLetter) {
		if (!hoister.gravity) {
		    hoister.gravity = .1;
		}
		// draw line to letter
		/*
		hoistArea.context.beginPath();
		hoistArea.context.moveTo(hoister.x, hoister.y);
		hoistArea.context.lineTo(grappleLetter.x, grappleLetter.y);
		hoistArea.context.stroke();
		*/
		hoistArea.context.linearPath([[hoister.x, hoister.y], [grappleLetter.x, grappleLetter.y]], {roughness: 5, seed: 1});

                var dist_sq = ((hoister.x - grappleLetter.x)**2 + (hoister.y - grappleLetter.y)**2);
                hoister.v_x -= (hoister.x - grappleLetter.x) * 3 / Math.sqrt(dist_sq);
                hoister.v_y -= (hoister.y - grappleLetter.y) * 3 / Math.sqrt(dist_sq);
        }
        hoistArea.key = '';
    }
    hoister.update();
}
    </script>
    </body>
</html>
